#!/bin/sh

if [ "$0" = "$BASH_SOURCE" ]; then
    echo "Error: Script must be sourced"
    exit 1
fi

BF_ROOT=$(git rev-parse --show-toplevel)
BOOKMARKS_SYNC_ROOT=$BF_ROOT/bfr/bookmarks-sync

PUSHED=0
if [ ! "$PWD" = "$BOOKMARKS_SYNC_ROOT" ]; then
    pushd $BOOKMARKS_SYNC_ROOT
    PUSHED=1
fi

echo "Creating Python venv"
python3 -m venv venv

echo "Activating Python venv"
echo "Run 'deactivate' to deactivate it"

activate () {
    source venv/bin/activate
}
activate

echo "Setting up Python venv"
pip3 install --upgrade pip
pip3 install -r src/tools/requirements.txt -r src/bookmarks_sync/requirements.txt

if [ $PUSHED = 1 ]; then
    popd
fi
