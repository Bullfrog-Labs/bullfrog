#!/bin/sh

if [ "$0" = "$BASH_SOURCE" ]; then
    echo "Error: Script must be sourced"
    exit 1
fi

BF_ROOT=$(git rev-parse --show-toplevel)
INGEST_GCF_ROOT=$BF_ROOT/bfr/ingest-gcf

PUSHED=0
if [ ! "$PWD" = "$INGEST_GCF_ROOT" ]; then
    pushd $INGEST_GCF_ROOT
    PUSHED=1
fi

echo "Creating Python venv"
python3 -m venv .venv

echo "Activating Python venv"
echo "Run 'deactivate' to deactivate it"

activate () {
    source .venv/bin/activate
}
activate

echo "Setting up Python venv"
pip3 install --upgrade pip
pip3 install -r src/requirements.txt -r tools/requirements.txt

if [ $PUSHED = 1 ]; then
    popd
fi
